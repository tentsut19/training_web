<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "timer" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-5 align-self-center">
            <h4 class="page-title">ตั้งค่าลงเวลาทำงาน</h4>
            <div class="d-flex align-items-center">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                        <li class="breadcrumb-item active" aria-current="page">ตั้งค่าลงเวลาทำงาน</li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="col-7 align-self-center"></div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header card-header-cover-table">
                    <div class="row">
                        <div class="col-9">
                            ตั้งค่าลงเวลาทำงาน
                        </div>
                        <div class="col-3">
                            <div class="d-flex no-block justify-content-end align-items-center">
                                <button type="button" class="btn btn-rounded btn-success" (click)="openModalAdd()">
                                    <i class="fa fa-plus"></i> เพิ่มข้อมูล</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form [formGroup]="searchForm">
                        <div class="row">
                            <div class="col-sm-12 col-md-4">
                                <div class="form-group m-b-30">
                                    <label for="master-data-category-search">ฝ่าย/แผนก</label>
                                    <select class="form-control" formControlName="mainTopicId">
                                        <option value="">--- ทั้งหมด ---</option>
                                        <option *ngFor="let item of mainTopicMasterList" value="{{item.id}}">{{item.title}}
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-2">
                                <br />
                                <div class="form-group">
                                <button type="button" class="btn btn-rounded btn-info" style="margin-top: 3.5%;" (click)="search(searchForm.value)"><i class="fa fa-search"></i> ค้นหา</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header card-header-cover-table">
                    <div class="row">
                        <div class="col-9">
                            รายการข้อมูล
                        </div>
                        <div class="col-3">
                             
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="master_data_table" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th style="width: 5%;" class="center">ลำดับ</th>
                                    <th style="width: 15%;">ฝ่าย/แผนก</th>
                                    <th style="width: 15%;">ภารกิจ</th>
                                    <th style="width: 25%;" left="center">รายละเอียด</th>
                                    <th style="width: 10%;" class="center">สถานะ</th>
                                    <th style="width: 5%;" class="center"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of timeSheetMasterList; index as i">
                                    <td style="width: 5%;" class="center">{{i+1}}</td>
                                    <td style="width: 15%;">{{item.mainTopic}}</td>
                                    <td style="width: 15%;">{{item.subTopic}}</td>
                                    <td style="width: 25%;" class="left">{{item.description}}</td>
                                    <td style="width: 10%;" class="center">
                                        <span *ngIf="item.active == 1" style="color: #44bd32;">เปิดใช้งาน</span>
                                        <span *ngIf="item.active != 1" style="color: #ff6e82;">ปิดใช้งาน</span>
                                    </td>
                                    <td style="width: 5%;" class="center">
                                            <i class="fas fa-edit btn-edit" (click)="openModalEdit(item)"></i>&nbsp;
                                            <i class="fas fa-trash-alt btn-remove" (click)="delete(item.id)"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 

<!-- Start Modal Delete -->
<div class="modal" id="modal-remove" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body center remove-modal-bg-content">
                <i class="fa fa-exclamation-circle warnnig-remove-icon" aria-hidden="true"></i><br />
                <span class="warnnig-remove-text">
                    คุณต้องการลบข้อมูลนี้
                </span>
            </div>
            <div class="modal-footer center">
                    <button type="button" class="btn btn-danger" (click)="deleteProcess(currentId)">ยืนยัน</button>&nbsp;
                    <button type="button" class="btn btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End Modal Delete -->

<!--Add modal-->
<div class="modal" id="modal-masterData-add" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-add">
                <h4 class="modal-title" id="exampleModalLabel1">เพิ่มข้อมูลพื้นฐาน</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                    <div class="form-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="inlineRadio1" (change)="topicSelection()" 
                            id="inlineRadio1" [(ngModel)]="topic" [ngModelOptions]="{standalone: true}" value="MAIN">
                            <label class="form-check-label" for="inlineRadio1">ฝ่าย/แผนก</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="inlineRadio2" (change)="topicSelection()"  
                            id="inlineRadio2" [(ngModel)]="topic" [ngModelOptions]="{standalone: true}" value="SUB">
                            <label class="form-check-label" for="inlineRadio2">ภารกิจ</label>
                        </div>
                    </div>
                <form *ngIf="topic == 'MAIN'" [formGroup]="mainTopicAddForm">
                    <div class="form-group">
                        <label for="title" class="control-label">ฝ่าย/แผนก <span class="star-required">*</span></label>
                        <input type="text" class="form-control" id="title" formControlName="title" [ngClass]="{ 'is-invalid': submitted_add && mainTopicAddForm.controls.title.errors }">
                        <div *ngIf="submitted_add &amp;&amp; mainTopicAddForm.controls.title.errors" class="text-danger">
                            <div *ngIf="mainTopicAddForm.controls.title.errors.required">โปรดระบุฝ่าย/แผนก</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description" class="control-label">รายละเอียด</label>
                        <textarea rows="2" class="form-control" formControlName="description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">สถานะ <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="active">
                            <option value="1" [selected]="true">เปิดใช้งาน</option>
                            <option value="0" [selected]="false">ปิดใช้งาน</option>
                        </select> 
                    </div>
                </form>
                <form *ngIf="topic == 'SUB'" [formGroup]="subTopicAddForm">
                    <div class="form-group">
                        <label for="mainTopicId" class="control-label">ฝ่าย/แผนก <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="mainTopicId" >
                            <option value="" [selected]="true">--- เลือกฝ่าย/แผนก ---</option>
                            <option *ngFor="let item of mainTopicMasterList" value="{{item.id}}">{{item.title}}</option>
                        </select> 
                        <div *ngIf="submitted_add &amp;&amp; subTopicAddForm.controls.mainTopicId.errors" class="text-danger">
                            <div *ngIf="subTopicAddForm.controls.mainTopicId.errors.required">โปรดเลือกฝ่าย/แผนก</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">ภารกิจ <span class="star-required">*</span></label>
                        <input type="text" class="form-control" id="title" formControlName="title" [ngClass]="{ 'is-invalid': submitted_add && subTopicAddForm.controls.title.errors }">
                        <div *ngIf="submitted_add &amp;&amp; subTopicAddForm.controls.title.errors" class="text-danger">
                            <div *ngIf="subTopicAddForm.controls.title.errors.required">โปรดระบุภารกิจ</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description" class="control-label">รายละเอียด</label>
                        <textarea rows="2" class="form-control" formControlName="description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">สถานะ <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="active">
                            <option value="1" [selected]="true">เปิดใช้งาน</option>
                            <option value="0" [selected]="false">ปิดใช้งาน</option>
                        </select> 
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button *ngIf="topic == 'MAIN'" type="button" class="btn btn-rounded btn-success" (click)="addMasterData(mainTopicAddForm)">บันทึก</button>
                <button *ngIf="topic == 'SUB'" type="button" class="btn btn-rounded btn-success" (click)="addMasterData(subTopicAddForm)">บันทึก</button>
                <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End Add modal-->


<!--Edit modal-->
<div class="modal" id="modal-masterData-edit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-edit">
                <h4 class="modal-title" id="exampleModalLabel1">แก้ไขข้อมูลพื้นฐาน</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                    <div class="form-group">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="searchDateType" (change)="topicSelection()" 
                            id="inlineRadio1" [(ngModel)]="topic" [ngModelOptions]="{standalone: true}" value="MAIN" disabled>
                            <label class="form-check-label" for="inlineRadio1">ฝ่าย/แผนก</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="searchDateType" (change)="topicSelection()"  
                            id="inlineRadio2" [(ngModel)]="topic" [ngModelOptions]="{standalone: true}" value="SUB" disabled>
                            <label class="form-check-label" for="inlineRadio2">ภารกิจ</label>
                        </div>
                    </div>
                <form *ngIf="topic == 'MAIN'" [formGroup]="mainTopicEditForm">
                    <div class="form-group">
                        <label for="title" class="control-label">ฝ่าย/แผนก <span class="star-required">*</span></label>
                        <input type="text" class="form-control" id="title" formControlName="title" [ngClass]="{ 'is-invalid': submitted_add && mainTopicEditForm.controls.title.errors }">
                        <div *ngIf="submitted_edit &amp;&amp; mainTopicEditForm.controls.title.errors" class="text-danger">
                            <div *ngIf="mainTopicEditForm.controls.title.errors.required">โปรดระบุฝ่าย/แผนก</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description" class="control-label">รายละเอียด</label>
                        <textarea rows="2" class="form-control" formControlName="description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">สถานะ <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="active">
                            <option value="1" [selected]="true">เปิดใช้งาน</option>
                            <option value="0" [selected]="false">ปิดใช้งาน</option>
                        </select> 
                    </div>
                </form>
                <form *ngIf="topic == 'SUB'" [formGroup]="subTopicEditForm">
                    <div class="form-group">
                        <label for="mainTopicId" class="control-label">ฝ่าย/แผนก <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="mainTopicId" >
                            <option value="">--- เลือกฝ่าย/แผนก ---</option>
                            <option *ngFor="let item of mainTopicMasterList" value="{{item.id}}">{{item.title}}</option>
                        </select> 
                        <div *ngIf="submitted_edit &amp;&amp; subTopicEditForm.controls.mainTopicId.errors" class="text-danger">
                            <div *ngIf="subTopicEditForm.controls.mainTopicId.errors.required">โปรดเลือกฝ่าย/แผนก</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">ภารกิจ <span class="star-required">*</span></label>
                        <input type="text" class="form-control" id="title" formControlName="title" [ngClass]="{ 'is-invalid': submitted_add && subTopicEditForm.controls.title.errors }">
                        <div *ngIf="submitted_edit &amp;&amp; subTopicEditForm.controls.title.errors" class="text-danger">
                            <div *ngIf="subTopicEditForm.controls.title.errors.required">โปรดระบุภารกิจ</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description" class="control-label">รายละเอียด</label>
                        <textarea rows="2" class="form-control" formControlName="description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="title" class="control-label">สถานะ <span class="star-required">*</span></label>
                        <select class="form-control" formControlName="active">
                            <option value="1" [selected]="true">เปิดใช้งาน</option>
                            <option value="0" [selected]="false">ปิดใช้งาน</option>
                        </select> 
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button *ngIf="topic == 'MAIN'" type="button" class="btn btn-rounded btn-success" (click)="updateMasterData(mainTopicEditForm)">บันทึก</button>
                <button *ngIf="topic == 'SUB'" type="button" class="btn btn-rounded btn-success" (click)="updateMasterData(subTopicEditForm)">บันทึก</button>
                <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End Edit modal-->