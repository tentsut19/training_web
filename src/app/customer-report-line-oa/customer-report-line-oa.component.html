<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "small" color = "#fff" type = "line-scale-party" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
<div class="page-breadcrumb">
  <div class="row">
      <div class="col-5 align-self-center">
          <h4 class="page-title">ลูกค้าแจ้งเรื่องจาก Line OA</h4>
          <div class="d-flex align-items-center">
              <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                      <li class="breadcrumb-item active" aria-current="page">ลูกค้าแจ้งเรื่องจาก Line OA</li>
                  </ol>
              </nav>
          </div>
      </div>
      <div class="col-7 align-self-center">
      </div>
  </div>
</div>
<br />
<div class="container-fluid">

  <div class="row">
      <div class="col-12">
          <div class="card">
              <div class="card-header card-header-cover-table">
                <div class="row">
                    <div class="col-5">
                        รายการลูกค้าแจ้งเรื่องจาก Line OA
                    </div>
                    <div class="col-7" style="text-align: right;">
                    </div>
                </div>
            </div>
              <div class="card-body">
                  <div class="table-responsive">
                    
                    <div class="row">
                        <div class="col-sm-12 col-md-4"></div>
                        <div class="col-sm-12 col-md-4">
                            <div class="form-group">
                                <input type="text" class="form-control input-search" (keyup)="applyFilter($event.target.value)" placeholder="พิมพ์เพื่อค้นหาข้อมูล">
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-4">
                        </div>
                    </div>
                      
                    <table mat-table [dataSource]="dataSource" matSort>
                        <ng-container matColumnDef="customer_name">
                          <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> หน่วยงาน </th>
                          <td mat-cell *matCellDef="let element">
                            {{element.customer_name}}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="customer_group_name">
                          <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> กลุ่ม Line </th>
                          <td mat-cell *matCellDef="let element">
                            {{element.customer_group_name}}
                            <div class="user-pic"><img src="{{element.customer_group_picture_url}}" alt="users" class="rounded-circle"
                                width="120" /></div>
                          </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="reporter">
                          <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> ผู้แจ้งเรื่อง </th>
                          <td mat-cell *matCellDef="let element">
                            {{element.display_name}} 
                            <div class="user-pic"><img src="{{element.picture_url}}" alt="users" class="rounded-circle"
                                width="120" /></div>
                          </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="message">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> ข้อความที่แจ้งเรื่อง </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.message}} 
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="created_at">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> วันเวลาที่แจ้งเรื่อง </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.created_at}} 
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="respondent">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> ผู้ตอบกลับ </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.reply_display_name}} 
                                <div class="user-pic"><img src="{{element.reply_picture_url}}" 
                                    alt="users" 
                                    class="rounded-circle" 
                                    width="120" 
                                    onerror="this.onerror=null; this.src='https://static.thenounproject.com/png/4595376-512.png';" />
                               </div>
                            </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="message_reply">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> ข้อความตอบกลับ </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.message_reply}} 
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="reply_datetime">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="green-header"> วันเวลาที่ตอบกลับ </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.reply_datetime}} 
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                      </table>
                      
                      <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons></mat-paginator>
                      

                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Start Modal Delete -->
<div class="modal" id="modal-remove" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body center remove-modal-bg-content">
                <i class="fa fa-exclamation-circle warnnig-remove-icon" aria-hidden="true"></i><br />
                <span class="warnnig-remove-text">
                    คุณต้องการลบพนักงานนี้
                </span>
            </div>
            <div class="modal-footer center">
                    <button type="button" class="btn btn-danger" (click)="deleteProcess(currentId)">ยืนยัน</button>&nbsp;
                    <button type="button" class="btn btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End Modal Delete -->

<!-- Start Modal BadHistory -->
<div class="modal" id="modal-bad-history" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-edit">
                <h4 class="modal-title" id="exampleModalLabel1">ประวัติด้านไม่ดี</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="row" *ngFor="let item of badHistoryList; index as i" >
                    <div class="panel-group col-sm-12 col-md-12">
                    <fieldset class="border p-2">
                        <legend  class="w-auto legend-header" style="text-align: left;color: #1ab196;"> {{item.description}}</legend>
                        <div class="row" style="padding-left: 2px;padding-right: 2px;">
                            <div class="card col-sm-12 col-md-12">
                                <div class="card-header">รายการหลักฐาน</div>
                                <div class="table-responsive">
                                    <table id="company_table" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th style="width: 10%;" class="center">ลำดับ</th>
                                                <th style="width: 40%;">ชื่อไฟล์</th>
                                                <th style="width: 10%;">วันที่อัพโหลดไฟล์</th>
                                                <th style="width: 10%;"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let item of item.fileInfoMap | keyvalue; index as i">
                                                <td style="width: 10%;" class="center">{{i+1}}</td>
                                                <td style="width: 40%;" class="left">{{item.value.name_origin}}</td>
                                                <td style="width: 10%;" class="left">{{item.value.created_at | date: 'dd/MM/yyyy HH:mm:ss'}}</td>
                                                <td style="width: 10%;" class="center">
                                                    <a type="button" class="btn btn-rounded btn-info" title="โหลดเอกสาร" target="_blank" href="{{ item.value.url }}">
                                                        <i class="fa fas fa-download"></i></a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                    <!-- basic-pagination -->
                                        <basic-pagination [itemStart]="itemStart" 
                                            [itemEnd]="itemEnd"
                                            [page]="page" 
                                            [count]="count"
                                            (pageOutPut)="handlePageChange($event)" 
                                            (pageSizeOutPut)="handlePageSizeChange($event)">
                                        </basic-pagination>
                                    <!-- basic-pagination -->
                            </div>
                        </div>
                    </fieldset>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ปิด</button>
            </div>
        </div>
    </div>
</div>
<!-- End Modal BadHistory -->

<!-- Delete sub company modal-->
<div class="modal" id="modal-employee-remove" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body center remove-modal-bg-content">
                <i class="fa fa-exclamation-circle warnnig-remove-icon" aria-hidden="true"></i><br />
                <span class="warnnig-remove-text">
                    คุณต้องการลบพนังานรายการนี้
                </span>
            </div>
            <div class="modal-footer center">
                    <button type="button" class="btn btn-rounded btn-danger" (click)="deleteProcess(currentId)">ยืนยัน</button>&nbsp;
                    <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End delete sub company modal-->

<!-- waitingTraining modal-->
<div class="modal" id="modal-waiting-training" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body center modal-header-edit">
                <i class="fa fa-exclamation-circle warnnig-remove-icon" aria-hidden="true"></i><br />
                <span class="warnnig-remove-text">
                    คุณต้องการปรับสถานะรอจบอบรมรายการนี้
                </span>
            </div>
            <div class="modal-footer center">
                    <button type="button" class="btn btn-rounded btn-warning" (click)="waitingTrainingProcess(currentId)">ยืนยัน</button>&nbsp;
                    <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End waitingTraining modal-->

<!-- Delete sub company modal-->
<div class="modal" id="modal-not-trained" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body center remove-modal-bg-content">
                <i class="fa fa-exclamation-circle warnnig-remove-icon" aria-hidden="true"></i><br />
                <span class="warnnig-remove-text">
                    คุณต้องการปรับสถานะไม่ผ่านอบรมรายการนี้
                </span>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="panel-group col-sm-12 col-md-12">
                        <div class="form-group">
                            <div class="input-group">
                              <div class="col-sm-12 col-md-12">
                                  <div class="form-group">
                                      <label>เหตุผลที่ไม่ผ่านอบรม <span class="star-required">*</span></label>
                                      <textarea class="form-control" id="reason" rows="3" [(ngModel)]="reasonNotTrained" 
                                      [ngClass]="{ 'is-invalid': invalidReasonNotTrained }"></textarea>
                                      <div *ngIf="invalidReasonNotTrained" class="text-danger">
                                        <div>โปรดระบุเหตุผลที่ไม่ผ่านอบรม</div>
                                      </div>
                                  </div>
                              </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer center">
                    <button type="button" class="btn btn-rounded btn-danger" (click)="notTrainedProcess(currentId)">ยืนยัน</button>&nbsp;
                    <button type="button" class="btn btn-rounded btn-light" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<!-- End delete sub company modal-->